<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>map</title>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=A72c32e3bbe184588573f8a8cf075e7a"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/CurveLine/1.5/src/CurveLine.min.js"></script>
    <script type="text/javascript">
        $(document).bind("contextmenu", function (e) {
            return false;
        });        
    </script>
    <style type="text/css">
        .iw_poi_title
        {
            color: #CC5522;
            font-size: 14px;
            font-weight: bold;
            overflow: hidden;
            padding-right: 13px;
            white-space: nowrap;
        }
        .iw_poi_content
        {
            font: 12px arial,sans-serif;
            overflow: visible;
            padding-top: 4px;
            white-space: -moz-pre-wrap;
        }
        
        .body1
        {
            height: 100%;
            overflow: hidden;
            margin: 2px;
            padding: 2px;
        }
        
        .box
        {
            height: 90%;
            position: absolute;
            width: 100%;
            border: #ccc solid 1px;
        }
    </style>
    <style type="text/css">
        html
        {
            height: 100%;
            margin: 1;
        }
        body
        {
            height: 100%;
            margin: 1;
        }
        
        .stuff
        {
            width: 240px;
            height: 200px;
            position: fixed;
            right: 1px;
            bottom: 1px;
            background: #fcfdfd;
            display: none;
            z-index: 111111;
            filter: alpha(opacity=50); /*支持 IE 浏览器*/
            -moz-opacity: 0.50; /*支持 FireFox 浏览器*/
            opacity: 0.50;
        }
    </style>
</head>
<body>
    <div id="loading" style="position: absolute; left: 50%; top: 40%;">
        <p>
            <img src="1.gif" width="30xp" height="30px" style="padding-left: 45px" /><br />
            <br />
        </p>
    </div>
    <div style="width: 100%; height: 100%; margin: 2px;" id="allmap"></div>
    <!-- <div class="stuff" style="display: none;">
        <div class="tipright">
            <ul class="forminfo" style="padding-left: 3px;">
                <li>
                    <table align="center">
                        <tr>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    管理处 <b>*</b></label>
                                <img src="images/bdmap/3-5.png" width="23xp" height="23px" />
                            </td>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    工作组 <b>*</b></label>
                                <img src="images/bdmap/驻地办.png" width="23xp" height="23px" />
                            </td>
                        </tr>
                    </table>
                </li>
                <li>
                    <table align="center">
                        <tr>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    合同段 <b>*</b></label>
                                <img src="images/bdmap/合同段.png" width="23xp" height="23px" />
                            </td>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    拌合站 <b>*</b></label>
                                <img src="images/bdmap/拌合站.png" width="23xp" height="23px" />
                            </td>
                        </tr>
                    </table>
                </li>
                <li>
                    <table align="center">
                        <tr>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    桩号<b>*</b></label>
                                <img src="images/bdmap/1-2.png" width="23xp" height="23px" />
                            </td>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    监控 <b>*</b></label>
                                <img src="images/bdmap/监控.png" width="23xp" height="23px" />
                            </td>
                        </tr>
                    </table>
                </li>               
                <li>
                    <table align="center">
                        <tr>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    隧道 <b>*</b></label>
                                <img src="images/bdmap/隧道.png" width="23xp" height="23px" />
                            </td>
                            <td style="width: 120px;">
                                <label style="width: 66px;">
                                    桥梁 <b>*</b></label>
                                <img src="images/bdmap/桥.png" width="23xp" height="23px" />
                            </td>
                        </tr>
                    </table>
                </li>
            </ul>
        </div>
    </div> -->
</body>
</html>
<script type="text/javascript">
	var data = "[{ title: '西安至韩城城际铁路', content: '本项目依托工程为新建城际铁路西安至韩城线，位于关中东部地区，关中盆地东北隅，是关中城市群城铁路网重要骨架线之一。线路全长224.11Km，新建线176.22Km，项目总投资298亿元。桥隧总长116.51Km，占线路长度的66.12%。设计时速200Km/h（基础设施预留提速250Km/h条件）。项目全线重点工程集中，地形地质特征明显。', point: '108.945604,34.382789', isOpen: 0, icon: { w: 23, h: 25, l: 41, t: 42, x: 9, lb: 12}}]"; 
    /*,{ title: 'K55+400', content: '一工作组起点', point: '108.243798|36.938121', isOpen: 0, icon: { w: 23, h: 25, l: 23, t: 0, x: 9, lb: 12},weatherStr: '无',SnararmNum: '无' },{ title: 'K84+200', content: '二工作组起点', point: '108.077733|37.135459', isOpen: 0, icon: { w: 23, h: 25, l: 23, t: 0, x: 9, lb: 12},weatherStr: '无',SnararmNum: '无' },{ title: 'K111+535', content: '三工作组起点', point: '107.91496|37.327911', isOpen: 0, icon: { w: 23, h: 25, l: 23, t: 0, x: 9, lb: 12},weatherStr: '无',SnararmNum: '无' },{ title: 'K146+980.986', content: '三工作组终点', point: '107.709494|37.558816', isOpen: 0, icon: { w: 23, h: 25, l: 23, t: 0, x: 9, lb: 12},weatherStr: '无',SnararmNum: '无' },{ title: '[LJ-11]1#拌合站', content: '[GZZ-3][LJJ-11]1#拌合站', point: '107.863485034431|37.3964048244217', isOpen: 0, icon: { w: 23, h: 25, l: 0, t:63, x: 9, lb: 12},weatherStr: '无' ,SnararmNum:'今日报警数:0'},{ title: '[LJ-11]2#拌合站', content: '[GZZ-3][LJJ-11]2#拌合站', point: '107.879765594116|37.3716570224926', isOpen: 0, icon: { w: 23, h: 25, l: 0, t:63, x: 9, lb: 12},weatherStr: '无',SnararmNum:'今日报警数:0'},{ title: '[LJ-2]1#拌合站', content: '[GZZ-1][LJJ-2]1#拌合站', point: '108.213420365422|36.9762252770523', isOpen: 0, icon: { w: 23, h: 25, l: 0, t: 63, x: 9, lb: 12},weatherStr: '无',SnararmNum:'今日报警数:0'}*/
    var markerArr = eval('('+data+')');
    initMap();
    /*function getMk() {
        $.ajax({
            url: "ShowMarker.aspx",
            type: "get",
            data: {},
            success: function (data) {
                $("#loading").css("display", "none");
                $(".stuff").css("display", "inline");
                markerArr = " [" + data + "]";
                markerArr = eval('(' + markerArr + ')');
                initMap();
            },
            error: function (e, a, b) {
            },
            dataType: "text"
        });
    }*/

    //创建和初始化地图函数：
    function initMap() {
        createMap(); //创建地图
        setMapEvent(); //设置地图事件
        addMapControl(); //向地图添加控件
        addMarker(); //向地图中添加marker
        addPolyline(); //向地图中添加线
    }

    //创建地图函数：
    function createMap() { 
        var map = new BMap.Map("allmap");//在百度地图容器中创建一个地图,设置卫星图为底图, { mapType: BMAP_HYBRID_MAP }
        var point = new BMap.Point(109.232199,34.736909);//定义一个中心点坐标
        map.centerAndZoom(point, 9); //设定地图的中心点和坐标并将地图显示在地图容器中
        map.addControl(new BMap.MapTypeControl({ mapType: BMAP_SATELLITE_MAP }));//将控件添加到地图，一个控件实例只能向地图中添加一次
        window.map = map; //将map变量存储在全局
    }

    //地图事件设置函数：
    function setMapEvent() {
        map.enableDragging(); //启用地图拖拽事件，默认启用(可不写)
        map.enableScrollWheelZoom(); //启用地图滚轮放大缩小
        map.enableDoubleClickZoom(); //启用鼠标双击放大，默认启用(可不写)
        map.enableKeyboard(); //启用键盘上下左右键移动地图
    }

    //地图控件添加函数：
    function addMapControl() {
        //向地图中添加缩放控件
        var ctrl_nav = new BMap.NavigationControl({ anchor: BMAP_ANCHOR_TOP_LEFT, type: BMAP_NAVIGATION_CONTROL_LARGE });
        map.addControl(ctrl_nav);
        //向地图中添加缩略图控件
        var ctrl_ove = new BMap.OverviewMapControl({ anchor: BMAP_ANCHOR_BOTTOM_RIGHT, isOpen: 1 });
        map.addControl(ctrl_ove);
        //向地图中添加比例尺控件
        var ctrl_sca = new BMap.ScaleControl({ anchor: BMAP_ANCHOR_BOTTOM_LEFT });
        map.addControl(ctrl_sca);
        //向地图中添加卫星图控件
        var map_type = new BMap.MapTypeControl({ mapType: BMAP_HYBRID_MAP });
        map.addControl(map_type);
        //map.setCurrentCity("陕西省"); 
    }

    function addMarker() {
        for (var i = 0; i < markerArr.length; i++) {      
            var json = markerArr[i];
            var point = new BMap.Point(json.point.split(",")[0], json.point.split(",")[1]);
            var iconImg = createIcon(json.icon);
            var marker = new BMap.Marker(point, { icon: iconImg });
            var iw = createInfoWindow(i);

            var label = new BMap.Label(json.title, { "offset": new BMap.Size(json.icon.lb - json.icon.x + 10, -20) });
            marker.setLabel(label);
            map.addOverlay(marker);
            label.setStyle({
                borderColor: "#808080",
                color: "#333",
                cursor: "pointer"
            });

            (function () {
                var index = i;
                var _marker = marker;
                var _iw = iw;

                _marker.addEventListener("click", function () {
                    this.openInfoWindow(_iw);
                });
                _iw.addEventListener("close", function () {
                    _marker.getLabel().show();
                })
                label.addEventListener("click", function () {
                    _marker.openInfoWindow(_iw);
                })
                if (json.isOpen) {
                    label.hide();
                    _marker.openInfoWindow(_iw);
                }
            })()
        }
    }
    //创建InfoWindow     
    function createInfoWindow(i) {
        var json = markerArr[i];
        var str = "";
        if (!json.title.indexOf("[")) {
            str += "</br></br><span><font color='Red'>" + json.SnararmNum + "</font></span>";
        } else if (!json.title.indexOf("K")) {
            str = "";
        } else {
            str = json.content;
        }
        var iw = new BMap.InfoWindow("<b class='iw_poi_title' title='" + json.title + "'>" + json.title + "</b><div class='iw_poi_content'>" + str + "</div>");
        return iw;
    }

    //创建一个Icon
    function createIcon(json) {
        var icon = new BMap.Icon("main.png",
        new BMap.Size(json.w, json.h), { imageOffset: new BMap.Size(-json.l, -json.t),
            infoWindowOffset: new BMap.Size(json.lb + 5, 1), offset: new BMap.Size(json.x, json.h)
        })
        return icon;
    }
    //百度地图API-开发-工具支持-地图生成器-添加标注
    //标注线数组
    
    //向地图中添加线函数
    function addPolyline() {
        var plPoints = [{ style: "solid", weight: 4, color: "red", opacity: 0.6, points: ["108.945604,34.382789"]},
        { style: "solid", weight: 4, color: "blue", opacity: 0.6, points: ["109.235361,34.67471"]},
        { style: "solid", weight: 4, color: "green", opacity: 0.6, points: ["109.180744,34.750435"]},
        { style: "solid", weight: 4, color: "yellow", opacity: 0.6, points: ["109.565937,34.943112"]},
        { style: "solid", weight: 4, color: "#f0f", opacity: 0.6, points: ["109.936471,35.187977"]},
        { style: "solid", weight: 4, color: "#0075c7", opacity: 0.6, points: ["110.098022,35.200956","110.44987,35.487842"]},];
        var len = plPoints.length - 1;
        for (var i = 0; i <= len; i++) {
            var json = plPoints[i];
            var points = [];
            for (var j = 0; j < json.points.length; j++) {
                var p1 = json.points[j].split(",")[0];
                var p2 = json.points[j].split(",")[1];
                points.push(new BMap.Point(p1, p2));
            }
            var line = new BMap.Polyline(points, { strokeStyle: json.style, strokeWeight: json.weight, strokeColor: json.color, strokeOpacity: json.opacity });
            map.addOverlay(line);
        }
    }
</script>

